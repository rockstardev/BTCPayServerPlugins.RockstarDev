@using BTCPayServer.Abstractions.Contracts
@using BTCPayServer.Abstractions.Extensions
@using static BTCPayServer.RockstarDev.Plugins.Payroll.PublicController
@inject BTCPayServer.Services.BTCPayServerEnvironment Env
@model PublicListInvoicesViewModel
@{
    Layout = null;
    ViewData["Title"] = "Your Payroll Invoices";
    ViewData["StoreBranding"] = Model.StoreBranding;
}
<!DOCTYPE html>
<html lang="en" @(Env.IsDeveloping ? " data-devenv" : "")>
<head>
    <partial name="LayoutHead" />
    <meta name="robots" content="noindex,nofollow">
</head>
<body class="min-vh-100">
    <div id="FormView" class="public-page-wrap" style="--wrap-max-width: 90%;">
        <main>

            <form method="post">
                <div class="sticky-header-setup"></div>
                <div class="sticky-header d-sm-flex align-items-center justify-content-between">
                    <h2 class="mb-0">@ViewData["Title"]</h2>
                    <div class="d-flex gap-3 mt-3 mt-sm-0">
                        <a asp-controller="Public" asp-action="Upload" asp-route-storeId="@Model.StoreId" class="btn btn-primary">Upload Invoice</a>
                        <a asp-controller="Public" asp-action="Logout" asp-route-storeId="@Model.StoreId" class="btn btn-secondary">Logout</a>
                    </div>
                </div>
            </form>

            <partial name="_StatusMessage" />

            @if (Model.Invoices.Any())
            {
                <form method="post" asp-action="MassAction">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="mass-action-head">
                                <tr>
                                    <th class="date-col">
                                        <div class="d-flex align-items-center gap-1">
                                            Created At
                                            <button type="button" class="btn btn-link p-0 fa fa-clock-o switch-time-format only-for-js" title="Switch date format"></button>
                                        </div>
                                    </th>
                                    <th scope="col">User</th>
                                    <th scope="col">Destination</th>
                                    <th scope="col">Amount</th>
                                    <th scope="col">Currency</th>
                                    <th scope="col">State</th>
                                    <th scope="col">Description</th>
                                    <th scope="col" class="text-end"></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var pp in Model.Invoices)
                                {
                                    var detailsId = $"invoice_details_{pp.Id}";
                                    <tr id="invoice_@pp.Id">
                                        <td>@pp.CreatedAt.ToBrowserDate()</td>
                                        <td>@pp.Name &lt;@pp.Email&gt;</td>
                                        <td>@pp.Destination</td>
                                        <td>@pp.Amount</td>
                                        <td>@pp.Currency</td>
                                        <td>@pp.State.ToString()</td>
                                        <td>
                                            @if (!String.IsNullOrEmpty(pp.Description))
                                            {
                                                <span class="text-break" data-bs-toggle="tooltip" title="@pp.Description" style="cursor: pointer;">
                                                    <span style="max-width: 250px;">@pp.Description</span>
                                                </span>
                                            }
                                        </td>
                                        <td class="text-end">
                                            <a href="/Storage/@pp.InvoiceUrl">Invoice</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    @section PageFootContent {
                    <script>
                        const ppProgresses = document.getElementsByClassName("ppProgress");
                        for (var i = 0; i < ppProgresses.length; i++) {
                            var pp = ppProgresses[i];
                            var ppId = pp.getAttribute("data-pp");
                            var template = document.getElementById("tooptip_template_" + ppId);
                            pp.setAttribute("title", template.innerHTML);
                        }
                    </script>
                    }
                </form>
            }
            else
            {
                <p class="text-secondary mt-4">
                    There are no active invoices submitted for payroll.
                </p>
            }


        </main>
        <footer class="store-footer">
            <a class="store-powered-by" href="https://btcpayserver.org" target="_blank" rel="noreferrer noopener">
                Powered by <partial name="_StoreFooterLogo" />
            </a>
        </footer>
    </div>
    <partial name="LayoutFoot" />
    <partial name="_ValidationScriptsPartial" />
</body>
</html>
