@using BTCPayServer.Abstractions.Contracts
@using BTCPayServer.Data
@using Microsoft.AspNetCore.Identity
@using BTCPayServer.RockstarDev.Plugins.MarkPaidCheckout
@inject SignInManager<ApplicationUser> SignInManager;
@inject IScopeProvider ScopeProvider
@{
    var storeId = ScopeProvider.GetCurrentStoreId();
}
@if (SignInManager.IsSignedIn(User) && !string.IsNullOrEmpty(storeId))
{
    var registry = Context.RequestServices.GetService(typeof(MarkPaidMethodsRegistry)) as MarkPaidMethodsRegistry;
    var path = Context.Request.Path.Value ?? string.Empty;
    if (registry is not null)
    {
        foreach (var method in registry.Methods)
        {
            var isActive = path.Contains($"/markpaid/{method}", System.StringComparison.OrdinalIgnoreCase);
            <li class="nav-item">
                <a class="nav-link @(isActive ? "active" : "")"
                   asp-route-storeId="@storeId"
                   asp-route-method="@method"
                   asp-action="MethodConfig"
                   asp-controller="MarkPaidStore">
                    <span class="me-2 btcpay-status btcpay-status--enabled"></span>
                    <span>@method</span>
                </a>
            </li>
        }
    }
}
