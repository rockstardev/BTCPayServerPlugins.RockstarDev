@model BTCPayServer.Models.InvoicingModels.CheckoutModel
@inject MarkPaidMethodsRegistry Registry
@inject Safe Safe

@foreach (var m in Registry.Methods)
{
    var component = MarkPaidUi.ComponentNameFor(m);
    <text>
        <template id="@component">
            <div>
                <a class="btn btn-primary rounded-pill w-100 mt-4" href="#" v-on:click.prevent="markAsPaid">Mark Settled</a>
            </div>
        </template>
        <script>
            Vue.component(@Safe.Json(component), {
                props: ['model', 'nfcSupported', 'nfcScanning', 'nfcErrorMessage', 'nfcWarningMessage'],
                template: @Safe.Json("#" + component),
                components: {qrcode: VueQrcode},
                data() {
                    return {currentTab: undefined, isProcessing: false};
                },
                methods: {
                    async markAsPaid() {
                        if (this.isProcessing)
                            return;
                        this.isProcessing = true;
                        const response = await fetch(this.model.invoiceBitcoinUrl, {
                            method: 'POST',
                            headers: {'X-Requested-With': 'RockstarHttpRequester'}
                        });

                        if ((await response.json()).success)
                            this.isProcessing = false;
                    }
                }
            });
        </script>
    </text>
}
